<h1 class="headinger"> <%= "#{project.name}" %>
  <% if current_user.id == project.user_id %>
    <span>
      <%= link_to edit_project_path(project), class: 'btn add-del-edit edit', title: "Edit Project Name" do %>
        <%= image_tag("http://icons.iconarchive.com/icons/designcontest/vintage/72/Pencil-icon.png") %>
      <% end %>
    </span>

    <span>
      <%= link_to project_path(project), remote: true, method: :delete, data: { confirm: 'Going forward will delete this project. Are you sure you want continue?'}, class: 'project-btn', title: "Delete Project" do %>
        <%= image_tag("http://icons.iconarchive.com/icons/dryicons/simplistica/48/delete-icon.png") %>
      <% end %>
    </span>

    <% if project.members.count >= 2 %>
      <span class="captainship">
        <%= form_tag(captain_project_path, method: "put", id: "captain-form") do %>
          <%= label_tag "transfer captainship" %>
          <%= select_tag(:user_id, options_from_collection_for_select(project.project_members, :id, :name)) %>
          <%= submit_tag("Submit", id: "submit", name: nil, class: "button-primary") %>
        <% end %>
      </span>
    <% end %>

  <% end %>
<h1>

<div class="row headinger">
  <h2> Members: </h2>
    <ol>
      <h3 class="indent">
        <li>
          <span class="create-tab leader-badge">
            <%= link_to project.user.name, user_path(project.user) %>
            <img src="https://cdn0.iconfinder.com/data/icons/awards-7/500/award_bravery--512.png" alt="Leader Image" title="Project Captain" />
            <span class="small-text"><i><%= "#{project.user.tabs.count} contributions" %></i></span>
          </span>
        </li>
        <% project.project_members.order("LOWER(name)").each do |user| %>
          <li>
            <%= link_to user.name, user_path(user) %>

            <% if current_user.id == project.user_id %>
              <span>
                <%= link_to boot_member_path(user.members.find_by(project_id: project.id)), remote: true, method: :delete, data: { confirm: 'Are you sure you want to delete this member?'}, class: 'project-btn' do %>
                  <%= image_tag("http://icons.iconarchive.com/icons/dryicons/simplistica/48/delete-icon.png", title: "Delete Member") %>
                <% end %>
              </span>
            <% end %>
            <span class="small-text"><i><%= "#{user.tabs.count} contributions" %></i></span>
          </li>
        <% end %>
        <div class="create-tab add-del-edit">
          <%= link_to new_member_path(project_id: project.id), class: 'btn add-del-edit' do %>
            <%= image_tag("http://icons.iconarchive.com/icons/dryicons/simplistica/48/add-icon.png", title: "Add New Member") %>
          <% end %>
        </div>
      </h3>
    </ol>

  <p> <%= link_to "Leave Project", leave_member_path, remote: true, method: :delete, data: { confirm: 'Are you sure you want to leave this project?' }, class: 'project-leave' %> </p>
</div>



<h2> Trees:</h2>

<div class="row trees">

  <% if current_user.trees.empty? %>
    <%= link_to "Create your first tree!", new_tree_path, class: 'btn add-del-edit edit'%>
  <% elsif (user_trees - project_trees).empty? %>
    <div class="new-tree">
      <%= link_to new_forest_tree_path(project_id: project.id), class: 'btn add-del-edit' do %>
        <%= image_tag("http://icons.iconarchive.com/icons/dryicons/simplistica/48/add-icon.png", title: "Add New Tree") %>
      <% end %>
    </div>
  <% else %>
    <div class="new-tree">
      <%= link_to new_forest_path(project_id: project.id), class: 'btn add-del-edit' do %>
        <%= image_tag("http://icons.iconarchive.com/icons/dryicons/simplistica/48/add-icon.png", title: "Add New Tree") %>
      <% end %>
    </div>
  <% end %>

  <% project.trees.order(:created_at).each do |tree| %>
    <h2> <%= link_to tree.name, tree %>

      <small class="btn sup-edit editor">
        <%= link_to edit_tree_path(tree), class: 'btn add-del-edit', title: "Edit Tree" do %>
          <%= image_tag("http://icons.iconarchive.com/icons/designcontest/vintage/72/Pencil-icon.png") %>
        <% end %>
      </small>
      <small class="btn sup-edit editor">
        <%= link_to forest_path(tree.forests.find_by(project_id: project.id)), remote: true, method: :delete, data: { confirm: 'Are you sure you want to delete this tree?'}, class: 'btn add-del-edit', title: "Delete Tree" do %>
          <%= image_tag("http://icons.iconarchive.com/icons/dryicons/simplistica/48/delete-icon.png") %>
        <% end %>
      </small>
    </h2>

    <% tree.tabs.each do |tab| %>
      <% if tab.parent.nil? %>
        <div class="trunk" id="root">
          <h3 class="btn leaf"><%= link_to truncate(tab.name, length: 12), url_with_protocol(tab.url) %>
            <div class="editor">
              <%= render "shared/buttons_tabs.html.erb", obj: tab %>
              <div class="creation">
                <%= render "shared/create_tab.html.erb", obj: tab %>
              </div>
            </div>
          </h3>

          <div class="big-block">

            <% tab.children.each do |child| %>
                <div class="branch">
                  <h3 class="btn leaf"><%= link_to truncate(child.name, length: 12), url_with_protocol(child.url) %>
                    <div class="editor">
                      <%= render "shared/buttons_tabs.html.erb", obj: tab, child: child %>
                      <div class="creation">
                        <%= render "shared/create_tab.html.erb", obj: child %>
                      </div>
                    </div>
                  </h3>

                    <% ########### Recursion! ##### %>

                    <%= render( partial: 'rechild', locals: { children: child.children }) if child %>

                    <% ########### /Recursion! ##### %>
                </div>
            <% end %>

          </div>
        </div>
      <% end %>
    <% end %>
  <% end %>

  </div>
</div>


<div class="row">
  <div class="tree-set">
    <% if current_user.trees.any? %>
      <div class="tree-block">

        <% current_user.trees.each do |tree| %>
          <h1> <%= link_to tree.name, tree_path(tree) %>
            <small class="btn sup-edit editor">
              <%= link_to edit_tree_path(tree), class: 'btn add-del-edit edit' do %>
                <%= image_tag("http://icons.iconarchive.com/icons/designcontest/vintage/72/Pencil-icon.png") %>
              <% end %>
            </small>
            <small class="btn sup-edit editor">
              <% unless tree.tabs.any? %>
                <%= link_to new_tab_path, class: 'btn add-del-edit new' do %>
                  <%= image_tag("http://icons.iconarchive.com/icons/designcontest/vintage/72/Pencil-icon.png") %>
                <% end %>
              <% end %>
            </small>
          </h1>

          <% tree.tabs.each do |tab| %>
            <% if tab.parent.nil? %>
              <div class="trunk" id="root">
                <h3 class="btn leaf"><%= link_to truncate(tab.name, length: 12), url_with_protocol(tab.url) %>
                  <div class="editor">
                    <%= render "shared/buttons_tabs.html.erb", obj: tab %>
                    <div class="creation">
                      <%= render "shared/create_tab.html.erb", obj: tab %>
                    </div>
                  </div>
                </h3>

                <div class="big-block">

                  <% tab.children.each do |child| %>
                      <div class="branch">
                        <h3 class="btn leaf"><%= link_to truncate(child.name, length: 12), url_with_protocol(child.url) %>
                          <div class="editor">
                            <%= render "shared/buttons_tabs.html.erb", obj: child %>
                            <div class="creation">
                              <%= render "shared/create_tab.html.erb", obj: child %>
                            </div>
                          </div>
                        </h3>

                          <% ########### Recursion! ##### %>

                          <%= render( partial: 'rechild', locals: { children: child.children }) if child %>

                          <% ########### /Recursion! ##### %>
                      </div>
                  <% end %>

                </div>
              </div>
            <% end %>
          <% end %>

        <% end %>
      </div>
      <div class="new-tree">
        <%= link_to "Create tree", new_tree_path, class: 'btn add-del-edit new'%>
      </div>
    <% else %>
      <h3> You have no trees </h3>
        <%= link_to "Create your first tree!", new_tree_path, class: 'btn add-del-edit edit'%>
    <% end %>
  </div>
</div>
